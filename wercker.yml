box: python:3.6-slim
initial-build:
  steps:
    # Install packages
    - script:
      name: Install packages
      code: |
        pip install virtualenv
        apt update
        apt install -y curl 
    - virtualenv:
      name: Setup virtualenv
      python_location: /usr/local/bin/python
      
    # This pip-install clears the local wheel cache
    - pip-install:
      clean_wheel_dir: true

    # A custom script step, name value is used in the UI
    # and the code value contains the command that get executed
    - script:
      name: echo python information
      code: |
        echo "python version $(python --version) running"
        echo "pip version $(pip --version) running"
    # Test app
    - script:
      name: test app
      code: pytest

  after-steps:
    - slack-notifier:
      channel: $SLACK_CHANNEL
      url: $SLACK_URL
      username: cicdbot